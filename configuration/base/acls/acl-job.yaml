apiVersion: batch/v1
kind: Job
metadata:
  name: acl-kafka-job
  namespace: confluent
  labels:
    app: kafka-acl
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: kafka-acl
          image: confluentinc/cp-kafka:latest
          command: ["/bin/bash", "-c"]
          args:
            - |
              chmod +x /tmp/acl-setup.sh
              /tmp/acl-setup.sh
          env:
            - name: KAFKA_BROKER
              valueFrom:
                configMapKeyRef:
                  name: kafka-config
                  key: broker-address
          volumeMounts:
            - name: acl-script
              mountPath: /tmp/acl-setup.sh
              subPath: acl-setup.sh
            - name: acl-config
              mountPath: /tmp/acl-config.yaml
              subPath: acl-config.yaml
            - name: kafka-admin-config
              mountPath: /tmp/admin.properties
              subPath: admin.properties
      volumes:
        - name: acl-script
          configMap:
            name: acl-kafka-script
            defaultMode: 0755
        - name: acl-config
          configMap:
            name: acl-kafka-config
        - name: kafka-admin-config
          secret:
            secretName: acl-admin-secret